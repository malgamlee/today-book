{"ast":null,"code":"// cookieStorage is useful Safari private browser mode, where localStorage\n// doesn't work but cookies do. This implementation is adopted from\n// https://developer.mozilla.org/en-US/docs/Web/API/Storage/LocalStorage\nvar util = require('../src/util');\n\nvar Global = util.Global;\nvar trim = util.trim;\nmodule.exports = {\n  name: 'cookieStorage',\n  read: read,\n  write: write,\n  each: each,\n  remove: remove,\n  clearAll: clearAll\n};\nvar doc = Global.document;\n\nfunction read(key) {\n  if (!key || !_has(key)) {\n    return null;\n  }\n\n  var regexpStr = \"(?:^|.*;\\\\s*)\" + escape(key).replace(/[\\-\\.\\+\\*]/g, \"\\\\$&\") + \"\\\\s*\\\\=\\\\s*((?:[^;](?!;))*[^;]?).*\";\n  return unescape(doc.cookie.replace(new RegExp(regexpStr), \"$1\"));\n}\n\nfunction each(callback) {\n  var cookies = doc.cookie.split(/; ?/g);\n\n  for (var i = cookies.length - 1; i >= 0; i--) {\n    if (!trim(cookies[i])) {\n      continue;\n    }\n\n    var kvp = cookies[i].split('=');\n    var key = unescape(kvp[0]);\n    var val = unescape(kvp[1]);\n    callback(val, key);\n  }\n}\n\nfunction write(key, data) {\n  if (!key) {\n    return;\n  }\n\n  doc.cookie = escape(key) + \"=\" + escape(data) + \"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/\";\n}\n\nfunction remove(key) {\n  if (!key || !_has(key)) {\n    return;\n  }\n\n  doc.cookie = escape(key) + \"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/\";\n}\n\nfunction clearAll() {\n  each(function (_, key) {\n    remove(key);\n  });\n}\n\nfunction _has(key) {\n  return new RegExp(\"(?:^|;\\\\s*)\" + escape(key).replace(/[\\-\\.\\+\\*]/g, \"\\\\$&\") + \"\\\\s*\\\\=\").test(doc.cookie);\n}","map":{"version":3,"names":["util","require","Global","trim","module","exports","name","read","write","each","remove","clearAll","doc","document","key","_has","regexpStr","escape","replace","unescape","cookie","RegExp","callback","cookies","split","i","length","kvp","val","data","_","test"],"sources":["/Users/jijeong/study/foundation-ts/node_modules/store/storages/cookieStorage.js"],"sourcesContent":["// cookieStorage is useful Safari private browser mode, where localStorage\n// doesn't work but cookies do. This implementation is adopted from\n// https://developer.mozilla.org/en-US/docs/Web/API/Storage/LocalStorage\n\nvar util = require('../src/util')\nvar Global = util.Global\nvar trim = util.trim\n\nmodule.exports = {\n\tname: 'cookieStorage',\n\tread: read,\n\twrite: write,\n\teach: each,\n\tremove: remove,\n\tclearAll: clearAll,\n}\n\nvar doc = Global.document\n\nfunction read(key) {\n\tif (!key || !_has(key)) { return null }\n\tvar regexpStr = \"(?:^|.*;\\\\s*)\" +\n\t\tescape(key).replace(/[\\-\\.\\+\\*]/g, \"\\\\$&\") +\n\t\t\"\\\\s*\\\\=\\\\s*((?:[^;](?!;))*[^;]?).*\"\n\treturn unescape(doc.cookie.replace(new RegExp(regexpStr), \"$1\"))\n}\n\nfunction each(callback) {\n\tvar cookies = doc.cookie.split(/; ?/g)\n\tfor (var i = cookies.length - 1; i >= 0; i--) {\n\t\tif (!trim(cookies[i])) {\n\t\t\tcontinue\n\t\t}\n\t\tvar kvp = cookies[i].split('=')\n\t\tvar key = unescape(kvp[0])\n\t\tvar val = unescape(kvp[1])\n\t\tcallback(val, key)\n\t}\n}\n\nfunction write(key, data) {\n\tif(!key) { return }\n\tdoc.cookie = escape(key) + \"=\" + escape(data) + \"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/\"\n}\n\nfunction remove(key) {\n\tif (!key || !_has(key)) {\n\t\treturn\n\t}\n\tdoc.cookie = escape(key) + \"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/\"\n}\n\nfunction clearAll() {\n\teach(function(_, key) {\n\t\tremove(key)\n\t})\n}\n\nfunction _has(key) {\n\treturn (new RegExp(\"(?:^|;\\\\s*)\" + escape(key).replace(/[\\-\\.\\+\\*]/g, \"\\\\$&\") + \"\\\\s*\\\\=\")).test(doc.cookie)\n}\n"],"mappings":"AAAA;AACA;AACA;AAEA,IAAIA,IAAI,GAAGC,OAAO,CAAC,aAAD,CAAlB;;AACA,IAAIC,MAAM,GAAGF,IAAI,CAACE,MAAlB;AACA,IAAIC,IAAI,GAAGH,IAAI,CAACG,IAAhB;AAEAC,MAAM,CAACC,OAAP,GAAiB;EAChBC,IAAI,EAAE,eADU;EAEhBC,IAAI,EAAEA,IAFU;EAGhBC,KAAK,EAAEA,KAHS;EAIhBC,IAAI,EAAEA,IAJU;EAKhBC,MAAM,EAAEA,MALQ;EAMhBC,QAAQ,EAAEA;AANM,CAAjB;AASA,IAAIC,GAAG,GAAGV,MAAM,CAACW,QAAjB;;AAEA,SAASN,IAAT,CAAcO,GAAd,EAAmB;EAClB,IAAI,CAACA,GAAD,IAAQ,CAACC,IAAI,CAACD,GAAD,CAAjB,EAAwB;IAAE,OAAO,IAAP;EAAa;;EACvC,IAAIE,SAAS,GAAG,kBACfC,MAAM,CAACH,GAAD,CAAN,CAAYI,OAAZ,CAAoB,aAApB,EAAmC,MAAnC,CADe,GAEf,oCAFD;EAGA,OAAOC,QAAQ,CAACP,GAAG,CAACQ,MAAJ,CAAWF,OAAX,CAAmB,IAAIG,MAAJ,CAAWL,SAAX,CAAnB,EAA0C,IAA1C,CAAD,CAAf;AACA;;AAED,SAASP,IAAT,CAAca,QAAd,EAAwB;EACvB,IAAIC,OAAO,GAAGX,GAAG,CAACQ,MAAJ,CAAWI,KAAX,CAAiB,MAAjB,CAAd;;EACA,KAAK,IAAIC,CAAC,GAAGF,OAAO,CAACG,MAAR,GAAiB,CAA9B,EAAiCD,CAAC,IAAI,CAAtC,EAAyCA,CAAC,EAA1C,EAA8C;IAC7C,IAAI,CAACtB,IAAI,CAACoB,OAAO,CAACE,CAAD,CAAR,CAAT,EAAuB;MACtB;IACA;;IACD,IAAIE,GAAG,GAAGJ,OAAO,CAACE,CAAD,CAAP,CAAWD,KAAX,CAAiB,GAAjB,CAAV;IACA,IAAIV,GAAG,GAAGK,QAAQ,CAACQ,GAAG,CAAC,CAAD,CAAJ,CAAlB;IACA,IAAIC,GAAG,GAAGT,QAAQ,CAACQ,GAAG,CAAC,CAAD,CAAJ,CAAlB;IACAL,QAAQ,CAACM,GAAD,EAAMd,GAAN,CAAR;EACA;AACD;;AAED,SAASN,KAAT,CAAeM,GAAf,EAAoBe,IAApB,EAA0B;EACzB,IAAG,CAACf,GAAJ,EAAS;IAAE;EAAQ;;EACnBF,GAAG,CAACQ,MAAJ,GAAaH,MAAM,CAACH,GAAD,CAAN,GAAc,GAAd,GAAoBG,MAAM,CAACY,IAAD,CAA1B,GAAmC,iDAAhD;AACA;;AAED,SAASnB,MAAT,CAAgBI,GAAhB,EAAqB;EACpB,IAAI,CAACA,GAAD,IAAQ,CAACC,IAAI,CAACD,GAAD,CAAjB,EAAwB;IACvB;EACA;;EACDF,GAAG,CAACQ,MAAJ,GAAaH,MAAM,CAACH,GAAD,CAAN,GAAc,kDAA3B;AACA;;AAED,SAASH,QAAT,GAAoB;EACnBF,IAAI,CAAC,UAASqB,CAAT,EAAYhB,GAAZ,EAAiB;IACrBJ,MAAM,CAACI,GAAD,CAAN;EACA,CAFG,CAAJ;AAGA;;AAED,SAASC,IAAT,CAAcD,GAAd,EAAmB;EAClB,OAAQ,IAAIO,MAAJ,CAAW,gBAAgBJ,MAAM,CAACH,GAAD,CAAN,CAAYI,OAAZ,CAAoB,aAApB,EAAmC,MAAnC,CAAhB,GAA6D,SAAxE,CAAD,CAAqFa,IAArF,CAA0FnB,GAAG,CAACQ,MAA9F,CAAP;AACA"},"metadata":{},"sourceType":"script"}